<!DOCTYPE html>
<html>
  <head>

    <meta charset="utf-8">

	  <title>California Protected Areas Data Portal</title>

    <meta name="description" content="">
	  <meta name="author" content="">
    <meta name="google-site-verification" content="7dej4jCbuusOJlIEYMbqRMG3b7whAst3-VM1u-qmfI4" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link rel="stylesheet" type="text/css" href="http://www.calands.org/css/base.css" />
	  <link rel="stylesheet" type="text/css" href="http://www.calands.org/css/skeleton-fluid.css" />
	  <link rel="stylesheet" type="text/css" href="http://www.calands.org/css/layout.css" />
    <link rel="stylesheet" type="text/css" href="http://www.calands.org/css/smoothness/jquery-ui-1.9.1.custom.css" />
    <link rel="stylesheet" type="text/css" href="http://www.calands.org/highslide/highslide.css" />
	  <link rel="stylesheet" type="text/css" href="http://www.calands.org/css/style.css" />
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />

    <script type="text/javascript">
		var BASE_URL = "http://www.calands.org/";
        var NAV_PAGE = "data";
	  </script>

    <script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
	  <script src="http://www.calands.org/js/jquery-1.9.0.min.js" type="text/javascript"></script>
	  <script src="http://www.calands.org/js/jquery-ui-1.10.0.custom.min.js" type="text/javascript"></script>
    <script src="http://www.calands.org/highslide/highslide-full_jscompress.js" type="text/javascript"></script>
	  <script src="http://www.calands.org/js/index.js" type="text/javascript"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="js/countyMap.js"></script>
    <script src="js/countyPie1.js"></script>
    <script src="js/countyPie2.js"></script>
    <script src="js/countyInfo.js"></script>
    <script src="js/cityMap.js"></script>
    <script src="js/cityPie1.js"></script>
    <script src="js/cityPie2.js"></script>
    <script src="js/cityInfo.js"></script>

  </head>

  <body>

    <div class="container">
		    <div class="header">

           <div class="one column">&nbsp;</div>

           <div class="five columns">
             <a href="http://www.calands.org/"><img src="http://www.calands.org/images/cpad-logo-blue.png" alt="California Protected Areas Data Portal" /></a>
           </div>

	         <div id="navigation" class="nine columns">
             <p class="login"><a href="http://www.calands.org/admin">Login</a></p>
                <ul>
          			<li>
          				<a href="http://www.calands.org/data">CPAD</a>
          				<div class="dd">
          					<ul>
          						<li><a href="http://www.calands.org/data">About CPAD</a></li>
          						<li><a href="http://www.calands.org/map">CPAD Map</a></li>
          						<li><a href="http://www.calands.org/data/uses">Uses</a></li>
          						<li><a href="http://www.calands.org/data/standards">Standards</a></li>
          						<li><a href="http://www.calands.org/data/history">History</a></li>
          						<li><a href="http://www.calands.org/data/statistics">Statistics</a></li>
          						<li><a href="http://www.calands.org/data/reports">Reports</a></li>
          						<li><a href="http://www.calands.org/data/related">Related Data</a></li>
          						<li><a href="http://www.calands.org/data/faqs">FAQs</a></li>
          						<li><a href="http://www.calands.org/data/metadata">Metadata</a></li>
          					</ul>
          				</div>
          			</li>
          			<li>
          				<a href="http://www.calands.org/cced">CCED</a>
          				<div class="dd">
          					<ul>
          						<li><a href="http://www.calands.org/cced">About CCED</a></li>
          						<li><a href="http://www.calands.org/ccedmap">CCED Map</a></li>
          					</ul>
          				</div>
          			</li>
          			<li>
          				<a href="http://www.calands.org/revise">revise</a>
          			</li>
          			<li>
        				<a href="http://www.calands.org/resources">resources</a>
        			  </li>
          			<li>
          				<a href="http://www.calands.org/news">news</a>
          			</li>
          			<li>
        				<a href="http://www.calands.org/about">about</a>
        			  </li>
      		   </ul>
      	    </div>
          </div>

        <div id="main" class="page" style="">

          <div id="breadcrumbs" style="">
              <p class="breadcrumbs"><a href="http://www.calands.org/">Home</a> > <a href="http://www.calands.org/data">Data</a> > <a href="http://localhost:8000/">CPAD Atlas</a></p>
          </div>

		      <h2 style="padding-top:0;">CPAD Atlas - Beta</h2>

          <div class="content" id="intro">
            <p>
              Use the new <strong>CPAD Atlas</strong> to visualize protected areas data statewide, by county or by selected cities - click on counties or cities to see details for those areas.
              <br>
              <br>
              CPAD's 49 million acres of land are distributed in different ways for each of the state's 58 counties and 500 cities - some counties are almost completely CPAD lands while others have very little such land, and comparing to population provides another view.
            </p>
          </div>
          <div id="tutorial">
            <img src="ilikenightFlickr_MtDiabloOak.jpg" width="435px">
          </div>

          <h3 id="h3County">CPAD Data by County</h3>

          <hr>

          <div id="countyChapter">

            <form id="countyNav" class="switch switch-blue">
                <input type="radio" class="countyDiv2" name="viewCountyTab" id="county1" checked>
                <label for="county1" class="switch-label switch-label-off">Map View</label>
                <input type="radio" class="countyDiv1" name="viewCountyTab" id="county2">
                <label for="county2" class="switch-label switch-label-on">Table View</label>
              <span class="switch-selection"></span>
            </form>

            <div id="countyTabs">

            <div id="countyDiv2" class="countyTab">

              <div id="countyMap" class="map">

              <div>
                <form class="mapScale">
                  <label><input type="Radio" name="dataset" id="ac_totCounty" class="radioCounty" value="ac_tot" checked> Total CPAD Acreage</label>
                  <label><input type="Radio" name="dataset" id="POP_NORMCounty" class="radioCounty" value="POP_NORM"> CPAD Acres per Inhabitant</label>
                </form>
              </div>

                <svg id="countyMapSvg" class="ca"></svg>

              </div>

            </div>

            <div id="countyDiv1" class="countyTab">

            <svg id="countyHeaders"></svg>

              <div id="countyTable" class="table">

              <svg id="countyIndex" class="cell"></svg>

              <svg id="countyRow"></svg>

                <script>

                d3.json("Counties_statsCorrected4.json", function(data) {

                var selectedTableHeader;

                var index = [];
                for (var i = 1; i < 59; i++) {index.push(i);}

                var indexRect = d3.select("#countyIndex").selectAll("rect")
                                 .data(index)
                                 .enter()
                                 .append("rect")
                                 .attr("y", function(d, i) {return i * 21;})
                                 .attr("x", 0)
                                 .attr("width", 20)
                                 .attr("height", 21)
                                 .attr("fill", "white")
                                 .classed("tableHeader", "true");

                var indexNumber = d3.select("#countyIndex").selectAll("text")
                             .data(index)
                             .enter()
                             .append("text")
                             .attr("y", function(d, i) {return (i*21) + 14;})
                             .attr("x", 10)
                             .attr("width", 20)
                             .attr("height", 21)
                             .attr("font-weight", "bold")
                             .text(function (d, i) {return d;});

                var width = 500,
                    height = 1000;

                var fieldHeight = 20;
                var fieldWidth = 145;

                var canvasH = d3.select("#countyHeaders")
                    .attr("width", width)
                    .attr("height", fieldHeight)
                    .attr("x", 20)
                    .append("g");

                var canvasR = d3.select("#countyRow")
                    .attr("width", width)
                    .attr("height", height)
                    .append("g");

                var headerGrp = canvasH.append("g")
                                .attr("class", "headerGrp")
                                .attr("x", 20);

                var rowsGrp = canvasR.append("g")
                              .attr("class","rowsGrp");

                var previousSort = null;

                refreshTable(null);

                function refreshTable(sortOn){

                  // create the table header
                  var header = headerGrp.selectAll("g")
                    .data(d3.keys(data[0]))
                    .enter()
                    .append("g")
                    .attr("class", "tableHeader")
                    .attr("transform", function (d, i){
                      return "translate("+ i* fieldWidth + ",0)";
                    })
                    .style("display", function (d, i) { if (i>=3) {return "none";}});

                  header.append("rect")
                    .attr("width", fieldWidth + 30)
                    .attr("height", fieldHeight);

                  header.append("text")
                    .attr("x", fieldWidth/2 + 25)
                    .attr("y", fieldHeight/2)
                    .attr("dy", ".35em")
                    .text(function (d) { return d;})
                    .style("cursor", function (d, i) {
                        if (i>=0) { return "s-resize";}
                        else { return "default";}
                      })
                    .on("click", function (d, i) {
                      selectedTableHeader = i;
                      if (i>=0) {
                      d3.select(".countyTableHeaderSelected").classed("countyTableHeaderSelected", false);
                      d3.select(this).classed("countyTableHeaderSelected", true);
                      return refreshTable(d);
                      }
                    });

                  // fill the table
                  // select rows
                  var rows = rowsGrp.selectAll("g.Tcounty").data(data,
                    function(d){ return d.County; });

                  // create rows
                  var rowsEnter = rows.enter().append("svg:g")
                    .attr("class", "Tcounty")
                    .attr("transform", function (d, i){
                      return "translate(0," + (i) * (fieldHeight+1) + ")";
                    })
                    .classed("selectedCounty", function(d) {return selectedCounty === d.County;})
                    .on("click", function(d) {
                                            selectedCounty = d.County;
                                            countyClass(d.County);
                                            updateCountyPie1(d.County);
                                            updateCountyPie2(d.County);
                                            updateCountyName(d.County);
                                            updateCountyTot(d3.format(",")(d["Total CPAD Acreage"]),d3.format(",")(d["County Population"]));
                                            updateCountyInh(d3.format(",")(d["CPAD Acres per 1,000 Inh."]));
                                          });

                  // select cells
                  var cells = rows.selectAll("g.cell").data(function(d){return d3.values(d);});

                  // create cells
                  var cellsEnter = cells.enter().append("svg:g")
                    .attr("class", "cell")
                    .attr("class", "Tcounty")
                    .attr("transform", function (d, i){
                      return "translate(" + i * fieldWidth + ",0)";
                    });

                  cellsEnter.append("rect")
                    .attr("width", fieldWidth)
                    .attr("height", fieldHeight);

                  cellsEnter.append("text")
                    .attr("x", fieldWidth / 2)
                    .attr("y", fieldHeight / 2)
                    .attr("dy", ".35em")
                    .text( function (d) { if (typeof d == "number") {
                      return d3.format(",")(d3.round(d));}
                      else {return d;}
                      });

                  //update if not in initialisation
                  // update rows

                  if(sortOn !== null) {
                            // update rows
                            rows.sort(
                             function(a,b){
                               if (selectedTableHeader>0) {return sort(b[sortOn], a[sortOn]);}
                               else {return sort(a[sortOn], b[sortOn]);}
                            });
                            previousSort = null;

                            rows.transition()
                              .duration(500)
                              .attr("transform", function (d, i){
                                return "translate(0," + (i) * (fieldHeight+1) + ")";
                              });
                        }
                      }

                function sort(a,b){
                    return a > b ? 1 : a == b ? 0 : -1;
                }

            });

                var updateCountyPie1;
                var updateCountyPie2;
                var updateCountyName;
                var updateCountyTot;
                var updateCountyInh;

                </script>

              </svg>

              <script type="text/javascript">

              (function(){
              var countyTabs = document.getElementById("countyTabs");
              var countyNav = $("input:radio[name=viewCountyTab]").click(function() {
                    var countyValue = $(this).val();
                    });

              //Hide all tabs
              function hideCountyTab1(){
              var countyTab1 = document.getElementById("countyDiv1");
                countyTab1.className = countyTab1.className + " hide";
              }

              function hideCountyTab2(){
              var countyTab2 = document.getElementById("countyDiv2");
                countyTab2.className = countyTab2.className + " hide";
              }

              //hide tabs on load
              hideCountyTab1();
              hideCountyTab2();

              function hideCountyTabs(){
              //var countyTab = countyTabs.$("#countyDiv1,#countyDiv2");
              var countyTab = countyTabs.getElementsByTagName("div");
              for(var i=0;i<=countyNav.length+1;i++){
              if(countyTab[i].className == "countyTab"){
                countyTab[i].className = countyTab[i].className + " hide";
              }
              }
              }

              //Show the clicked tab
              function showCountyTab(countyTab){
              document.getElementById(countyTab).className = "countyTab";
              }

              //Add click events
              for(var i=0;i<countyNav.length;i++){
              countyNav[i].onclick = function(){
              hideCountyTabs();
              showCountyTab(this.className);
              }
              }

              showCountyTab("countyDiv2");
              }) ();

              </script>
            </div>

            </div>
          </div>

            <div id="countyPies" class="pie">

              <svg id="countyName" class="selectedElement" style="height: 40px; width: 100%;"></svg>

              <svg id="countyTot" class="selectedElement" style="height: 20px; width: 100%;"></svg>

              <svg id="countyInh" class="selectedElement" style="height: 20px; width: 100%;"></svg>

              <svg id="countyPie1" class="pieChart" style="height: 210px; width: 100%;"></svg>

              <svg id="countyPie2" class="pieChart" style="height: 260px; width: 100%;"></svg>

            </div>

          </div>

      <h3 id="h3City">CPAD Data for 50 Most Populous Cities</h3>

      <hr>

      <div id="cityChapter">

        <form id="cityNav" class="switch switch-blue">
            <input type="radio" class="cityDiv2" name="viewCityTab" id="city1" checked>
            <label for="city1" class="switch-label switch-label-off">Map View</label>
            <input type="radio" class="cityDiv1" name="viewCityTab" id="city2">
            <label for="city2" class="switch-label switch-label-on">Table View</label>
          <span class="switch-selection"></span>
        </form>

        <div id="cityTabs">

        <div id="cityDiv2" class="cityTab">

          <div id="cityMap" class="map">

          <div>
            <form class="mapScale">
              <label><input type="Radio" name="dataset" id="ac_totCity" class="radioCity" value="ac_tot" checked> Total CPAD Acreage</label>
              <label><input type="Radio" name="dataset" id="POP_NORMCity" class="radioCity" value="POP_NORM"> CPAD Acres per Inhabitant</label>
            </form>
          </div>

            <svg id="cityMapSvg" class="ca"></svg>

          </div>

        </div>

        <div id="cityDiv1" class="cityTab">

        <svg id="cityHeaders"></svg>

          <div id="cityTable" class="table">

          <svg id="cityIndex" class="cell"></svg>

          <svg id="cityRow"></svg>

            <script>

            d3.json("LargestCities50_Cpad_withpop.json", function(data) {

            var selectedTableHeader;

            var index = [];
            for (var i = 1; i < 51; i++) {index.push(i);}

            var indexRect = d3.select("#cityIndex").selectAll("rect")
                             .data(index)
                             .enter()
                             .append("rect")
                             .attr("y", function(d, i) {return i * 21;})
                             .attr("x", 0)
                             .attr("width", 20)
                             .attr("height", 21)
                             .attr("fill", "white")
                             .classed("tableHeader", "true");

            var indexNumber = d3.select("#cityIndex").selectAll("text")
                         .data(index)
                         .enter()
                         .append("text")
                         .attr("y", function(d, i) {return (i*21) + 14;})
                         .attr("x", 10)
                         .attr("width", 20)
                         .attr("height", 21)
                         .attr("font-weight", "bold")
                         .text(function (d) {return d;});

            var width = 500,
                height = 1000;

            var fieldHeight = 20;
            var fieldWidth = 145;

            var canvasH = d3.select("#cityHeaders")
                .attr("width", width)
                .attr("height", fieldHeight)
                .attr("x", 20)
                .append("g");

            var canvasR = d3.select("#cityRow")
                .attr("width", width)
                .attr("height", height)
                .append("g");

            var headerGrp = canvasH.append("g")
                            .attr("class", "headerGrp")
                            .attr("x", 20);

            var rowsGrp = canvasR.append("g")
                          .attr("class","rowsGrp");

            var previousSort = null;

            refreshTable(null);

            function refreshTable(sortOn){

              // create the table header
              var header = headerGrp.selectAll("g")
                .data(d3.keys(data[0]))
                .enter()
                .append("g")
                .attr("class", "tableHeader")
                .attr("transform", function (d, i) {
                  return "translate("+ i* fieldWidth + ",0)";
                })
                .style("display", function (d, i) { if (i>=3) {return "none";}});

              header.append("rect")
                .attr("width", fieldWidth + 30)
                .attr("height", fieldHeight);

              header.append("text")
                .attr("x", fieldWidth/2 + 25)
                .attr("y", fieldHeight/2)
                .attr("dy", ".35em")
                .text(function (d) {return d;})
                .style("cursor", "s-resize")
                .on("click", function (d, i) {
                  selectedTableHeader = i;
                  d3.select(".cityTableHeaderSelected").classed("cityTableHeaderSelected", false);
                  d3.select(this).classed("cityTableHeaderSelected", true);
                  return refreshTable(d);
                });

              // fill the table
              // select rows
              var rows = rowsGrp.selectAll("g.Tcity").data(data,
                function(d){ return d.City; });

              // create rows
              var rowsEnter = rows.enter().append("svg:g")
                .attr("class", "Tcity")
                .classed("selectedCity", function(d) {return selectedCity === d.City;})
                .attr("transform", function (d, i){
                  return "translate(0," + (i) * (fieldHeight+1) + ")";
                })
                .on("click", function(d) {
                                        selectedCity = d.City;
                                        cityClass(d.City);
                                        updateCityPie1(d.City);
                                        updateCityPie2(d.City);
                                        updateCityName(d.City);
                                        updateCityInh(d3.format(",")(d["CPAD Acres per 1,000 Inh."]));
                                        updateCityTot(d3.format(",")(d["Total CPAD Acreage"]),d3.format(",")(d["City Population"]));
                                      });

              // select cells
              var cells = rows.selectAll("g.cell").data(function(d){return d3.values(d);});

              // create cells
              var cellsEnter = cells.enter().append("svg:g")
                .attr("class", "cell")
                .attr("class", "Tcity")
                .attr("transform", function (d, i){
                  return "translate(" + i * fieldWidth + ",0)";
                });

              cellsEnter.append("rect")
                .attr("width", fieldWidth)
                .attr("height", fieldHeight);

              cellsEnter.append("text")
                .attr("x", fieldWidth / 2)
                .attr("y", fieldHeight / 2)
                .attr("dy", ".35em")
                .text( function (d) { if (typeof d == "number") {
                  return d3.format(',')(d);}
                  else {return d;}
                  });

              //update if not in initialisation
              // update rows

              if(sortOn !== null) {
                        // update rows
                        rows.sort(
                         function(a,b){
                           if (selectedTableHeader>0) {return sort(b[sortOn], a[sortOn]);}
                           else {return sort(a[sortOn], b[sortOn]);}
                        });
                        previousSort = null;

                        rows.transition()
                          .duration(500)
                          .attr("transform", function (d, i){
                            return "translate(0," + (i) * (fieldHeight+1) + ")";
                          });
                    }
                  }

            function sort(a,b){
                return a > b ? 1 : a == b ? 0 : -1;
            }

        });

            var updateCityPie1;
            var updateCityPie2;
            var updateCityName;
            var updateCityTot;
            var updateCityInh;

            </script>

          </svg>

          <script type="text/javascript">

          (function(){
          var cityTabs = document.getElementById("cityTabs");
          var cityNav = $("input:radio[name=viewCityTab]").click(function() {
                var cityValue = $(this).val();
                });

          //Hide all tabs
          function hideCityTab1(){
          var cityTab1 = document.getElementById("cityDiv1");
            cityTab1.className = cityTab1.className + " hide";
          }

          function hideCityTab2(){
          var cityTab2 = document.getElementById("cityDiv2");
            cityTab2.className = cityTab2.className + " hide";
          }

          //hide tabs on load
          hideCityTab1();
          hideCityTab2();

          function hideCityTabs(){
          var cityTab = cityTabs.getElementsByTagName("div");
          for(var i=0;i<=cityNav.length+1;i++){
          if(cityTab[i].className == "cityTab"){
            cityTab[i].className = cityTab[i].className + " hide";
          }
          }
          }

          //Show the clicked tab
          function showCityTab(cityTab){
          document.getElementById(cityTab).className = "cityTab";
          }

          //Add click events
          for(var i=0;i<cityNav.length;i++){
          cityNav[i].onclick = function(){
          hideCityTabs();
          showCityTab(this.className);
          }
          }

          showCityTab("cityDiv2");
          }) ();

          </script>
        </div>

        </div>
      </div>

        <div id="cityPies" class="pie">

          <svg id="cityName" class="selectedElement" style="height: 40px; width: 100%;"></svg>

          <svg id="cityTot" class="selectedElement" style="height: 20px; width: 100%;"></svg>

          <svg id="cityInh" class="selectedElement" style="height: 20px; width: 100%;"></svg>

          <svg id="cityPie1" class="pieChart" style="height: 210px; width: 100%;"></svg>

          <svg id="cityPie2" class="pieChart" style="height: 260px; width: 100%;"></svg>

        </div>

        <div id="cityDataNote" class="pie">
          <p>
            <em>*Data shows CPAD acres within the municipal boundaries of the 50 most populous cities in California (2012 data). Cities with high acreages often have large regional, state or federal parks within their boundaries.</em>
          </p>
        </div>

      </div>

    </div>
  </body>
</html>
